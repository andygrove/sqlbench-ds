GlobalLimit 100
+- LocalLimit 100
   +- Sort [customer_id#3937 ASC NULLS FIRST, customer_first_name#3938 ASC NULLS FIRST, customer_last_name#3939 ASC NULLS FIRST, customer_email_address#3943 ASC NULLS FIRST], true
      +- Project [customer_id#3937, customer_first_name#3938, customer_last_name#3939, customer_email_address#3943]
         +- Join Inner, ((customer_id#3869 = customer_id#3957) AND (CASE WHEN (year_total#4287 > 0.00) THEN CheckOverflow((promote_precision(year_total#3965) / promote_precision(year_total#4287)), DecimalType(38,20), true) ELSE 0E-20 END > CASE WHEN (year_total#3877 > 0.00) THEN CheckOverflow((promote_precision(year_total#3945) / promote_precision(year_total#3877)), DecimalType(38,20), true) ELSE 0E-20 END))
            :- Project [customer_id#3869, year_total#3877, customer_id#3937, customer_first_name#3938, customer_last_name#3939, customer_email_address#3943, year_total#3945, year_total#4287]
            :  +- Join Inner, (customer_id#3869 = customer_id#4279)
            :     :- Join Inner, (customer_id#3937 = customer_id#3869)
            :     :  :- Filter (isnotnull(year_total#3877) AND (year_total#3877 > 0.00))
            :     :  :  +- Aggregate [c_customer_id#401, c_first_name#408, c_last_name#409, c_preferred_cust_flag#410, c_birth_country#414, c_login#415, c_email_address#416, d_year#618], [c_customer_id#401 AS customer_id#3869, MakeDecimal(sum(UnscaledValue(CheckOverflow((promote_precision(cast(ss_ext_list_price#269 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#266 as decimal(8,2)))), DecimalType(8,2), true))),18,2) AS year_total#3877]
            :     :  :     +- Project [c_customer_id#401, c_first_name#408, c_last_name#409, c_preferred_cust_flag#410, c_birth_country#414, c_login#415, c_email_address#416, ss_ext_discount_amt#266, ss_ext_list_price#269, d_year#618]
            :     :  :        +- Join Inner, (ss_sold_date_sk#252 = d_date_sk#612)
            :     :  :           :- Project [c_customer_id#401, c_first_name#408, c_last_name#409, c_preferred_cust_flag#410, c_birth_country#414, c_login#415, c_email_address#416, ss_sold_date_sk#252, ss_ext_discount_amt#266, ss_ext_list_price#269]
            :     :  :           :  +- Join Inner, (c_customer_sk#400 = ss_customer_sk#255)
            :     :  :           :     :- Project [c_customer_sk#400, c_customer_id#401, c_first_name#408, c_last_name#409, c_preferred_cust_flag#410, c_birth_country#414, c_login#415, c_email_address#416]
            :     :  :           :     :  +- Filter (isnotnull(c_customer_sk#400) AND isnotnull(c_customer_id#401))
            :     :  :           :     :     +- Relation [c_customer_sk#400,c_customer_id#401,c_current_cdemo_sk#402,c_current_hdemo_sk#403,c_current_addr_sk#404,c_first_shipto_date_sk#405,c_first_sales_date_sk#406,c_salutation#407,c_first_name#408,c_last_name#409,c_preferred_cust_flag#410,c_birth_day#411,c_birth_month#412,c_birth_year#413,c_birth_country#414,c_login#415,c_email_address#416,c_last_review_date_sk#417] parquet
            :     :  :           :     +- Project [ss_sold_date_sk#252, ss_customer_sk#255, ss_ext_discount_amt#266, ss_ext_list_price#269]
            :     :  :           :        +- Filter (isnotnull(ss_customer_sk#255) AND isnotnull(ss_sold_date_sk#252))
            :     :  :           :           +- Relation [ss_sold_date_sk#252,ss_sold_time_sk#253,ss_item_sk#254,ss_customer_sk#255,ss_cdemo_sk#256,ss_hdemo_sk#257,ss_addr_sk#258,ss_store_sk#259,ss_promo_sk#260,ss_ticket_number#261L,ss_quantity#262,ss_wholesale_cost#263,ss_list_price#264,ss_sales_price#265,ss_ext_discount_amt#266,ss_ext_sales_price#267,ss_ext_wholesale_cost#268,ss_ext_list_price#269,ss_ext_tax#270,ss_coupon_amt#271,ss_net_paid#272,ss_net_paid_inc_tax#273,ss_net_profit#274] parquet
            :     :  :           +- Project [d_date_sk#612, d_year#618]
            :     :  :              +- Filter ((isnotnull(d_year#618) AND (d_year#618 = 2001)) AND isnotnull(d_date_sk#612))
            :     :  :                 +- Relation [d_date_sk#612,d_date_id#613,d_date#614,d_month_seq#615,d_week_seq#616,d_quarter_seq#617,d_year#618,d_dow#619,d_moy#620,d_dom#621,d_qoy#622,d_fy_year#623,d_fy_quarter_seq#624,d_fy_week_seq#625,d_day_name#626,d_quarter_name#627,d_holiday#628,d_weekend#629,d_following_holiday#630,d_first_dom#631,d_last_dom#632,d_same_day_ly#633,d_same_day_lq#634,d_current_day#635,... 4 more fields] parquet
            :     :  +- Aggregate [c_customer_id#3972, c_first_name#3979, c_last_name#3980, c_preferred_cust_flag#3981, c_birth_country#3985, c_login#3986, c_email_address#3987, d_year#4018], [c_customer_id#3972 AS customer_id#3937, c_first_name#3979 AS customer_first_name#3938, c_last_name#3980 AS customer_last_name#3939, c_email_address#3987 AS customer_email_address#3943, MakeDecimal(sum(UnscaledValue(CheckOverflow((promote_precision(cast(ss_ext_list_price#4006 as decimal(8,2))) - promote_precision(cast(ss_ext_discount_amt#4003 as decimal(8,2)))), DecimalType(8,2), true))),18,2) AS year_total#3945]
            :     :     +- Project [c_customer_id#3972, c_first_name#3979, c_last_name#3980, c_preferred_cust_flag#3981, c_birth_country#3985, c_login#3986, c_email_address#3987, ss_ext_discount_amt#4003, ss_ext_list_price#4006, d_year#4018]
            :     :        +- Join Inner, (ss_sold_date_sk#3989 = d_date_sk#4012)
            :     :           :- Project [c_customer_id#3972, c_first_name#3979, c_last_name#3980, c_preferred_cust_flag#3981, c_birth_country#3985, c_login#3986, c_email_address#3987, ss_sold_date_sk#3989, ss_ext_discount_amt#4003, ss_ext_list_price#4006]
            :     :           :  +- Join Inner, (c_customer_sk#3971 = ss_customer_sk#3992)
            :     :           :     :- Project [c_customer_sk#3971, c_customer_id#3972, c_first_name#3979, c_last_name#3980, c_preferred_cust_flag#3981, c_birth_country#3985, c_login#3986, c_email_address#3987]
            :     :           :     :  +- Filter (isnotnull(c_customer_sk#3971) AND isnotnull(c_customer_id#3972))
            :     :           :     :     +- Relation [c_customer_sk#3971,c_customer_id#3972,c_current_cdemo_sk#3973,c_current_hdemo_sk#3974,c_current_addr_sk#3975,c_first_shipto_date_sk#3976,c_first_sales_date_sk#3977,c_salutation#3978,c_first_name#3979,c_last_name#3980,c_preferred_cust_flag#3981,c_birth_day#3982,c_birth_month#3983,c_birth_year#3984,c_birth_country#3985,c_login#3986,c_email_address#3987,c_last_review_date_sk#3988] parquet
            :     :           :     +- Project [ss_sold_date_sk#3989, ss_customer_sk#3992, ss_ext_discount_amt#4003, ss_ext_list_price#4006]
            :     :           :        +- Filter (isnotnull(ss_customer_sk#3992) AND isnotnull(ss_sold_date_sk#3989))
            :     :           :           +- Relation [ss_sold_date_sk#3989,ss_sold_time_sk#3990,ss_item_sk#3991,ss_customer_sk#3992,ss_cdemo_sk#3993,ss_hdemo_sk#3994,ss_addr_sk#3995,ss_store_sk#3996,ss_promo_sk#3997,ss_ticket_number#3998L,ss_quantity#3999,ss_wholesale_cost#4000,ss_list_price#4001,ss_sales_price#4002,ss_ext_discount_amt#4003,ss_ext_sales_price#4004,ss_ext_wholesale_cost#4005,ss_ext_list_price#4006,ss_ext_tax#4007,ss_coupon_amt#4008,ss_net_paid#4009,ss_net_paid_inc_tax#4010,ss_net_profit#4011] parquet
            :     :           +- Project [d_date_sk#4012, d_year#4018]
            :     :              +- Filter ((isnotnull(d_year#4018) AND (d_year#4018 = 2002)) AND isnotnull(d_date_sk#4012))
            :     :                 +- Relation [d_date_sk#4012,d_date_id#4013,d_date#4014,d_month_seq#4015,d_week_seq#4016,d_quarter_seq#4017,d_year#4018,d_dow#4019,d_moy#4020,d_dom#4021,d_qoy#4022,d_fy_year#4023,d_fy_quarter_seq#4024,d_fy_week_seq#4025,d_day_name#4026,d_quarter_name#4027,d_holiday#4028,d_weekend#4029,d_following_holiday#4030,d_first_dom#4031,d_last_dom#4032,d_same_day_ly#4033,d_same_day_lq#4034,d_current_day#4035,... 4 more fields] parquet
            :     +- Project [customer_id#3879 AS customer_id#4279, year_total#3887 AS year_total#4287]
            :        +- Filter (isnotnull(year_total#3887) AND (year_total#3887 > 0.00))
            :           +- Aggregate [c_customer_id#4200, c_first_name#4207, c_last_name#4208, c_preferred_cust_flag#4209, c_birth_country#4213, c_login#4214, c_email_address#4215, d_year#4257], [c_customer_id#4200 AS customer_id#3879, MakeDecimal(sum(UnscaledValue(CheckOverflow((promote_precision(cast(ws_ext_list_price#4242 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#4239 as decimal(8,2)))), DecimalType(8,2), true))),18,2) AS year_total#3887]
            :              +- Project [c_customer_id#4200, c_first_name#4207, c_last_name#4208, c_preferred_cust_flag#4209, c_birth_country#4213, c_login#4214, c_email_address#4215, ws_ext_discount_amt#4239, ws_ext_list_price#4242, d_year#4257]
            :                 +- Join Inner, (ws_sold_date_sk#4217 = d_date_sk#4251)
            :                    :- Project [c_customer_id#4200, c_first_name#4207, c_last_name#4208, c_preferred_cust_flag#4209, c_birth_country#4213, c_login#4214, c_email_address#4215, ws_sold_date_sk#4217, ws_ext_discount_amt#4239, ws_ext_list_price#4242]
            :                    :  +- Join Inner, (c_customer_sk#4199 = ws_bill_customer_sk#4221)
            :                    :     :- Project [c_customer_sk#4199, c_customer_id#4200, c_first_name#4207, c_last_name#4208, c_preferred_cust_flag#4209, c_birth_country#4213, c_login#4214, c_email_address#4215]
            :                    :     :  +- Filter (isnotnull(c_customer_sk#4199) AND isnotnull(c_customer_id#4200))
            :                    :     :     +- Relation [c_customer_sk#4199,c_customer_id#4200,c_current_cdemo_sk#4201,c_current_hdemo_sk#4202,c_current_addr_sk#4203,c_first_shipto_date_sk#4204,c_first_sales_date_sk#4205,c_salutation#4206,c_first_name#4207,c_last_name#4208,c_preferred_cust_flag#4209,c_birth_day#4210,c_birth_month#4211,c_birth_year#4212,c_birth_country#4213,c_login#4214,c_email_address#4215,c_last_review_date_sk#4216] parquet
            :                    :     +- Project [ws_sold_date_sk#4217, ws_bill_customer_sk#4221, ws_ext_discount_amt#4239, ws_ext_list_price#4242]
            :                    :        +- Filter (isnotnull(ws_bill_customer_sk#4221) AND isnotnull(ws_sold_date_sk#4217))
            :                    :           +- Relation [ws_sold_date_sk#4217,ws_sold_time_sk#4218,ws_ship_date_sk#4219,ws_item_sk#4220,ws_bill_customer_sk#4221,ws_bill_cdemo_sk#4222,ws_bill_hdemo_sk#4223,ws_bill_addr_sk#4224,ws_ship_customer_sk#4225,ws_ship_cdemo_sk#4226,ws_ship_hdemo_sk#4227,ws_ship_addr_sk#4228,ws_web_page_sk#4229,ws_web_site_sk#4230,ws_ship_mode_sk#4231,ws_warehouse_sk#4232,ws_promo_sk#4233,ws_order_number#4234L,ws_quantity#4235,ws_wholesale_cost#4236,ws_list_price#4237,ws_sales_price#4238,ws_ext_discount_amt#4239,ws_ext_sales_price#4240,... 10 more fields] parquet
            :                    +- Project [d_date_sk#4251, d_year#4257]
            :                       +- Filter ((isnotnull(d_year#4257) AND (d_year#4257 = 2001)) AND isnotnull(d_date_sk#4251))
            :                          +- Relation [d_date_sk#4251,d_date_id#4252,d_date#4253,d_month_seq#4254,d_week_seq#4255,d_quarter_seq#4256,d_year#4257,d_dow#4258,d_moy#4259,d_dom#4260,d_qoy#4261,d_fy_year#4262,d_fy_quarter_seq#4263,d_fy_week_seq#4264,d_day_name#4265,d_quarter_name#4266,d_holiday#4267,d_weekend#4268,d_following_holiday#4269,d_first_dom#4270,d_last_dom#4271,d_same_day_ly#4272,d_same_day_lq#4273,d_current_day#4274,... 4 more fields] parquet
            +- Aggregate [c_customer_id#4359, c_first_name#4366, c_last_name#4367, c_preferred_cust_flag#4368, c_birth_country#4372, c_login#4373, c_email_address#4374, d_year#4416], [c_customer_id#4359 AS customer_id#3957, MakeDecimal(sum(UnscaledValue(CheckOverflow((promote_precision(cast(ws_ext_list_price#4401 as decimal(8,2))) - promote_precision(cast(ws_ext_discount_amt#4398 as decimal(8,2)))), DecimalType(8,2), true))),18,2) AS year_total#3965]
               +- Project [c_customer_id#4359, c_first_name#4366, c_last_name#4367, c_preferred_cust_flag#4368, c_birth_country#4372, c_login#4373, c_email_address#4374, ws_ext_discount_amt#4398, ws_ext_list_price#4401, d_year#4416]
                  +- Join Inner, (ws_sold_date_sk#4376 = d_date_sk#4410)
                     :- Project [c_customer_id#4359, c_first_name#4366, c_last_name#4367, c_preferred_cust_flag#4368, c_birth_country#4372, c_login#4373, c_email_address#4374, ws_sold_date_sk#4376, ws_ext_discount_amt#4398, ws_ext_list_price#4401]
                     :  +- Join Inner, (c_customer_sk#4358 = ws_bill_customer_sk#4380)
                     :     :- Project [c_customer_sk#4358, c_customer_id#4359, c_first_name#4366, c_last_name#4367, c_preferred_cust_flag#4368, c_birth_country#4372, c_login#4373, c_email_address#4374]
                     :     :  +- Filter (isnotnull(c_customer_sk#4358) AND isnotnull(c_customer_id#4359))
                     :     :     +- Relation [c_customer_sk#4358,c_customer_id#4359,c_current_cdemo_sk#4360,c_current_hdemo_sk#4361,c_current_addr_sk#4362,c_first_shipto_date_sk#4363,c_first_sales_date_sk#4364,c_salutation#4365,c_first_name#4366,c_last_name#4367,c_preferred_cust_flag#4368,c_birth_day#4369,c_birth_month#4370,c_birth_year#4371,c_birth_country#4372,c_login#4373,c_email_address#4374,c_last_review_date_sk#4375] parquet
                     :     +- Project [ws_sold_date_sk#4376, ws_bill_customer_sk#4380, ws_ext_discount_amt#4398, ws_ext_list_price#4401]
                     :        +- Filter (isnotnull(ws_bill_customer_sk#4380) AND isnotnull(ws_sold_date_sk#4376))
                     :           +- Relation [ws_sold_date_sk#4376,ws_sold_time_sk#4377,ws_ship_date_sk#4378,ws_item_sk#4379,ws_bill_customer_sk#4380,ws_bill_cdemo_sk#4381,ws_bill_hdemo_sk#4382,ws_bill_addr_sk#4383,ws_ship_customer_sk#4384,ws_ship_cdemo_sk#4385,ws_ship_hdemo_sk#4386,ws_ship_addr_sk#4387,ws_web_page_sk#4388,ws_web_site_sk#4389,ws_ship_mode_sk#4390,ws_warehouse_sk#4391,ws_promo_sk#4392,ws_order_number#4393L,ws_quantity#4394,ws_wholesale_cost#4395,ws_list_price#4396,ws_sales_price#4397,ws_ext_discount_amt#4398,ws_ext_sales_price#4399,... 10 more fields] parquet
                     +- Project [d_date_sk#4410, d_year#4416]
                        +- Filter ((isnotnull(d_year#4416) AND (d_year#4416 = 2002)) AND isnotnull(d_date_sk#4410))
                           +- Relation [d_date_sk#4410,d_date_id#4411,d_date#4412,d_month_seq#4413,d_week_seq#4414,d_quarter_seq#4415,d_year#4416,d_dow#4417,d_moy#4418,d_dom#4419,d_qoy#4420,d_fy_year#4421,d_fy_quarter_seq#4422,d_fy_week_seq#4423,d_day_name#4424,d_quarter_name#4425,d_holiday#4426,d_weekend#4427,d_following_holiday#4428,d_first_dom#4429,d_last_dom#4430,d_same_day_ly#4431,d_same_day_lq#4432,d_current_day#4433,... 4 more fields] parquet
